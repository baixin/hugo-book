<div class="flex flex-wrap justify-between">

<div>
{{ if and .GitInfo .Site.Params.BookLastChangeLink }}
  {{- $date := partial "docs/date" (dict "Date" .Lastmod "Format" .Site.Params.BookDateFormat) -}}
  <a class="flex align-center" href="{{ partial "docs/links/commit" . }}" title='{{ i18n "Last modified by" }} {{ .GitInfo.AuthorName }} | {{ $date }}' target="_blank" rel="noopener">
    <img src="{{ partial "docs/icon" "calendar" }}" class="book-icon" alt="" />
    <span>{{ $date }}</span>
  </a>
{{ end }}
</div>

<div>
{{ if and .File .Site.Params.BookEditLink }}
  <a class="flex align-center" href="{{ partial "docs/links/edit" . }}" target="_blank" rel="noopener edit">
    <img src="{{ partial "docs/icon" "edit" }}" class="book-icon" alt="" />
    <span>{{ i18n "Edit this page" }}</span>
  </a>
{{ end }}
</div>

</div>

<!-- <script>
document.addEventListener("DOMContentLoaded", function() {
  const links = document.querySelectorAll('.download-link[data-file]');
  links.forEach(link => {
    link.addEventListener('click', function(e) {
      e.preventDefault();
      const url = this.href;
      const fileName = this.dataset.file;

      fetch('https://download-collector.ctf-book.workers.dev/collect-download', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ file: fileName })
      }).then(() => {
        setTimeout(() => { window.location = url; }, 200);
      }).catch(() => {
        window.location = url;
      });
    });
  });
});
</script> -->

<script>
document.addEventListener('click', function(e) {
  // 找到最近的 .download-link[data-file] 元素
  const link = e.target.closest('.download-link[data-file]');
  if (!link) return; // 不是下载链接，直接返回

  e.preventDefault(); // 阻止默认跳转
  const url = link.href;
  const fileName = link.dataset.file;

  // 发送下载统计请求
  fetch('https://download-collector.ctf-book.workers.dev/collect-download', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ file: fileName })
  }).then(() => {
    // 等 200ms 后再跳转下载文件
    setTimeout(() => { window.location = url; }, 200);
  }).catch(() => {
    // 出错也跳转下载文件
    window.location = url;
  });
});
</script>

{{ partial "docs/prev-next" . }}

{{ $script := resources.Get "clipboard.js" | resources.Minify }}
{{ with $script.Content }}
  <script>{{ . | safeJS }}</script>
{{ end }}
